<div class="header">
  <h1>Lista de Pacientes</h1>

  <div class="d-flex align-items-center flex-wrap gap-3 mt-3">
    <!-- Input de búsqueda con ícono -->
    <div class="input-group" style="width: 300px;">
      <span class="input-group-text bg-white border-end-0">
        <i class="bi bi-search"></i>
      </span>
      <input
        type="text"
        class="form-control border-start-0"
        placeholder="Buscar por DNI"
        (keyup)="applyFilter($event)">
    </div>

    <!-- Selector de tipo de servicio -->
    <div class="input-group" style="width: 260px;">
      <span class="input-group-text bg-white border-end-0">
        <i class="bi bi-ui-checks"></i>
      </span>
      <select class="form-select border-start-0" [(ngModel)]="tipoServicio">
        <option value="">Tipo de servicio</option>
        <option value="emergencia">Emergencia</option>
        <option value="hospitalizacion">Hospitalización</option>
        <option value="consulta_externa">Consulta externa</option>
      </select>
    </div>
  </div>
</div>


<div class="table-container">
  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z1">
    <ng-container matColumnDef="dni">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>DNI</th>
      <td mat-cell *matCellDef="let paciente">{{paciente.dni}}</td>
    </ng-container>

    <ng-container matColumnDef="nombre">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
      <td mat-cell *matCellDef="let paciente">{{paciente.nombre}}</td>
    </ng-container>

    <ng-container matColumnDef="edad">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Edad</th>
      <td mat-cell *matCellDef="let paciente">{{paciente.edad}} años</td>
    </ng-container>

    <ng-container matColumnDef="fecha">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha</th>
      <td mat-cell *matCellDef="let paciente">{{paciente.fecha}}</td>
    </ng-container>

    <ng-container matColumnDef="hora">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Hora</th>
      <td mat-cell *matCellDef="let paciente">{{paciente.hora}}</td>
    </ng-container>

    <ng-container matColumnDef="ubicacion">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Ubicación</th>
      <td mat-cell *matCellDef="let paciente">
        <mat-chip color="primary" selected>{{paciente.ubicacion}}</mat-chip>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row 
      *matRowDef="let row; columns: displayedColumns;"
      [class.selected]="selectedPatient === row"
      (click)="selectPatient(row)">
  </tr>
  </table>

  <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Seleccionar página"></mat-paginator>
</div>

<!-- Formulario -->
<div class="patient-form-container" *ngIf="selectedPatient">
  <div class="row">
    <div class="col-lg-9">
      <h2>Datos de Filiación</h2>
      <form [formGroup]="patientForm" class="patient-form">
        <div class="row g-3">
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Nombre</mat-label>
              <input matInput formControlName="nombre">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Ap. Paterno</mat-label>
              <input matInput formControlName="apellidoPaterno">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Ap. Materno</mat-label>
              <input matInput formControlName="apellidoMaterno">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Fec. Nac.</mat-label>
              <input matInput type="date" formControlName="fechaNacimiento">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Lugar Nac.</mat-label>
              <input matInput formControlName="lugarNacimiento">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Dirección</mat-label>
              <input matInput formControlName="direccion">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Est. Civil</mat-label>
              <input matInput formControlName="estadoCivil">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Grado Inst.</mat-label>
              <input matInput formControlName="gradoInstruccion">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>DNI</mat-label>
              <input matInput formControlName="dni">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Sexo</mat-label>
              <input matInput formControlName="sexo">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Edad</mat-label>
              <input matInput type="number" formControlName="edad">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Religión</mat-label>
              <input matInput formControlName="religion">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Grupo sanguíneo</mat-label>
              <input matInput formControlName="grupoSanguineo">
            </mat-form-field>
          </div>
          <div class="col-md-2">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Factor RH</mat-label>
              <input matInput formControlName="factorRH">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Ocupación</mat-label>
              <input matInput formControlName="ocupacion">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Familiar encargado</mat-label>
              <input matInput formControlName="familiarEncargado">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Estado Actual</mat-label>
              <input matInput formControlName="estadoActual">
            </mat-form-field>
          </div>
        </div>
        <hr class="my-4" />
        <h5>Historia de la Enfermedad</h5>
        <div class="row g-3 align-items-end">
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Fecha ingreso</mat-label>
              <input matInput type="date" formControlName="fechaIngreso">
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Desde</mat-label>
              <input matInput type="date" formControlName="fechaDesde">
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Hasta</mat-label>
              <input matInput type="date" formControlName="fechaHasta">
            </mat-form-field>
          </div>
        </div>
        <div class="row g-3 mt-2">
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Tiempo de enfermedad</mat-label>
              <input matInput formControlName="tiempoEnfermedad">
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Forma de inicio</mat-label>
              <input matInput formControlName="formaInicio">
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Curso</mat-label>
              <input matInput formControlName="curso">
            </mat-form-field>
          </div>
        </div>
        <div class="row g-3 mt-2">
          <div class="col-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Síntomas y signos principales</mat-label>
              <input matInput formControlName="sintomasPrincipales">
            </mat-form-field>
          </div>
        </div>
        <div class="row g-3 mt-2">
          <div class="col-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Anamnesis</mat-label>
              <textarea matInput rows="4" formControlName="anamnesis"></textarea>
            </mat-form-field>
          </div>
        </div>
        <hr class="my-4" />
        <h5>Funciones Biológicas</h5>
        <div class="row g-3">
          <div class="col-md-2" *ngFor="let key of ['apetito','sed','sueño','deposicion','miccion','deseoSexual']">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>{{ key | titlecase }}</mat-label>
              <input matInput [formControlName]="key">
            </mat-form-field>
          </div>
        </div>
        <hr class="my-4" />
        <h5>Antecedentes</h5>
        <div class="row g-3">
          <div class="col-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Personales</mat-label>
              <textarea matInput rows="3" formControlName="personales"></textarea>
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Inicio de Relaciones Sexuales</mat-label>
              <input matInput formControlName="inicioRelacionesSexuales">
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>MAC</mat-label>
              <input matInput formControlName="mac">
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Parejas Sentimentales</mat-label>
              <input matInput formControlName="parejasSentimentales">
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>RC</mat-label>
              <input matInput formControlName="rc">
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Abuso Sexual</mat-label>
              <input matInput formControlName="abusoSexual">
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>FUR</mat-label>
              <input matInput formControlName="fur">
            </mat-form-field>
          </div>
        </div>
        <div class="row g-3 mt-2">
          <div class="col-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Historia Académica</mat-label>
              <textarea matInput rows="3" formControlName="historiaAcademica"></textarea>
            </mat-form-field>
          </div>
        </div>
      </form>
    </div>
    <div class="col-lg-3 d-flex flex-column align-items-stretch justify-content-start">
      <div class="actions-section mt-3 mt-lg-0">
        <h3>Acciones</h3>
        <div class="action-buttons">
          <button mat-raised-button color="primary" class="action-button">Agregar historia</button>
          <button mat-raised-button color="accent" class="action-button">Nueva solicitud</button>
          <button mat-raised-button color="warn" class="action-button">Interconsulta</button>
          <button mat-raised-button class="action-button">Ingresar notas de enfermería</button>
          <button mat-raised-button class="action-button">Ingresar receta médica</button>
        </div>
      </div>
    </div>
  </div>
</div>
